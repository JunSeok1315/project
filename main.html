<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Idle</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>

    <link rel="stylesheet" href="./css/main.css" />
    <link rel="stylesheet" href="./css/font.css" />
    <link rel="stylesheet" href="./css/lookModal.css" />
    <link rel="stylesheet" href="./css/putModal.css" />
  </head>

  <body>
    <div class="modal_wrap">
      <div class="modal_bg">
        <div class="wrap">
          <div class="logo">
            <h1 class="font_DNFBitBitv2">I Five</h1>
            <button id="btn-modal" class="font_NeoDunggeunmo">등록⭐</button>
          </div>
          <div class="card-wrap" id="card">
            <!-- <div class="card-flip">
              <div class="card-inner">
                <div class="front-card">
                  <img
                    src="https://img.freepik.com/free-vector/flat-design-thug-life-sunglasses-illustration_23-2150209328.jpg?w=826&t=st=1703205239~exp=1703205839~hmac=4ca364056d836fb07395ecb75d9f866abbd7e9e7e6513c7bcc112644a803f038"
                    alt="forword-img"
                  />
                </div>
                <div class="back-card">
                  <img
                    src="https://img.freepik.com/free-vector/flat-design-thug-life-sunglasses-illustration_23-2150209328.jpg?w=826&t=st=1703205239~exp=1703205839~hmac=4ca364056d836fb07395ecb75d9f866abbd7e9e7e6513c7bcc112644a803f038"
                    alt="back-card"
                  />
                  <h4 class="card title" id="name">신준석</h4>
                  <a data-toggle="modal" href="#" class="readmore"
                    >자세히 보기</a
                  >
                </div>
              </div>
            </div> -->
          </div>
        </div>
        <!-- 등록 모달창 -->
        <div id="regmodal">
          <div class="form_container">
            <div class="top_bar">
              <h1>등록하기</h1>
            </div>
            <div class="uploadImg">
              <div class="filebox">
                <div class="imageupload">
                  <div class="imgbackground">
                    <img id="preview" />
                  </div>
                  <input
                    type="file"
                    id="file1"
                    class="upload-hidden"
                    name="file1"
                    accept="image/*"
                    onchange="readURL(this);"
                  />
                  <label for="file1">이미지 첨부</label>
                </div>
                <div class="allfloatinglabel">
                  <div class="floatinglabel1">
                    <input
                      type="email"
                      class="form-control"
                      id="user_name"
                      placeholder="이름"
                    />
                  </div>
                  <div class="floatinglabel1">
                    <input
                      type="email"
                      class="form-control"
                      id="user_mbti"
                      placeholder="MBTI"
                    />
                  </div>
                  <div class="floatinglabel1">
                    <input
                      type="email"
                      class="form-control"
                      id="BLOG"
                      placeholder="블로그 주소"
                    />
                  </div>
                  <div class="floatinglabel1">
                    <input
                      type="email"
                      class="form-control"
                      id="GITHUB"
                      placeholder="git hub 주소"
                    />
                  </div>
                </div>
              </div>
              <div class="modal_content">
                <textarea
                  name="advantages"
                  id="advantages"
                  placeholder="장점"
                ></textarea>
                <textarea
                  name="collaborate"
                  id="collaborate"
                  placeholder="협업 스타일"
                ></textarea>
              </div>

              <div class="mybtn">
                <button type="button" id="savebtn">등록하기</button>
                <button type="button" id="closemodal">취소하기</button>
              </div>
            </div>
          </div>
        </div>
        <!-- 자세히보기(look) 모달창 -->
        <div id="retouchBg">
          <!-- <div class="modal_container">
            <button type="button" class="close_btn" id="closemodal">
              <i class="fa-solid fa-x"></i>
            </button>
            <div class="modal_info">
              <div class="user_img">
                <img src="./image/user.jpg" alt="user image" />
              </div>
              <div class="user_info">
                <label for="user_name">이름</label>
                <input
                  type="text"
                  name="user_name"
                  id="user_name"
                  value=""
                  readonly
                />
                <label for="user_mbti">MBTI</label>
                <input
                  type="text"
                  name="user_mbti"
                  id="user_mbti"
                  value=""
                  readonly
                />
                <div class="user_url">
                  <a href="#" class="velog_color">
                    <i class="fa-solid fa-v"></i>
                  </a>
                  <a href="#" class="github_color">
                    <i class="fa-brands fa-github"></i>
                  </a>
                </div>
              </div>
            </div>
            <div class="modal_content">
              <label for="advantages">장점</label>
              <textarea name="advantages" id="advantages" readonly></textarea>
              <label for="collaborate">협업 스타일</label>
              <textarea name="collaborate" id="collaborate" readonly></textarea>
            </div>
            <div class="modal_btns">
              <button type="button" id="fix">수정하기</button>
              <button type="button" id="del">삭제하기</button>
            </div>
          </div> -->
        </div>
      </div>
    </div>

    <script type="module">
      // Firebase SDK 라이브러리 가져오기
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        doc,
        deleteDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      // Firebase 구성 정보 설정
      const firebaseConfig = {
        apiKey: "AIzaSyB_R5K58rxDN6wQemVP3067gsIaGrwUoGo",
        authDomain: "ifive-cd465.firebaseapp.com",
        projectId: "ifive-cd465",
        storageBucket: "ifive-cd465.appspot.com",
        messagingSenderId: "1070461934002",
        appId: "1:1070461934002:web:b6d44b5db984524fb56cab",
        measurementId: "G-D8SVZCST80",
      };

      // Firebase 인스턴스 초기화
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      $("#savebtn").click(async function () {
        // 사용자가 입력한 값 가져오기
        let user_name = $("#user_name").val();
        let user_mbti = $("#user_mbti").val();
        let advantages = $("#advantages").val();
        let collaborate = $("#collaborate").val();

        // Firebase에 데이터 추가
        let doc = {
          user_name: user_name,
          user_mbti: user_mbti,
          advantages: advantages,
          collaborate: collaborate,
        };
        await addDoc(collection(db, "user"), doc);

        // 알림 후 페이지 새로고침
        alert("등록 완료!");
        window.location.reload();
      });

      let docs = await getDocs(collection(db, "user"));
      docs.forEach((doc) => {
        let row = doc.data();
        console.log(row);

        let user_name = row["user_name"];
        let user_mbti = row["user_mbti"];
        let advantages = row["advantages"];
        let collaborate = row["collaborate"];

        let temp_html = `          <div class="card-wrap" id="card">
            <div class="card-flip">
              <div class="card-inner">
                <div class="front-card">
                  <img
                    src="https://img.freepik.com/free-vector/flat-design-thug-life-sunglasses-illustration_23-2150209328.jpg?w=826&t=st=1703205239~exp=1703205839~hmac=4ca364056d836fb07395ecb75d9f866abbd7e9e7e65 13c7bcc112644a803f038"
                    alt="forword-img"
                  />
                </div>
                <div class="back-card">
                  <img
                    src="https://img.freepik.com/free-vector/flat-design-thug-life-sunglasses-illustration_23-2150209328.jpg?w=826&t=st=1703205239~exp=1703205839~hmac=4ca364056d836fb07395ecb75d9f866abbd7e9e7e6513c7bcc112644a803f038"
                    alt="back-card"
                  />  
                  <h4 class="card title" id="name">${user_name}</h4>
                  <a data-toggle="modal" href="#" class="readmore"
                    >자세히 보기</a
                  >
                </div>
              </div>
            </div>
          </div>
          
`;
        let temp_html2 = `       <div class="modal_container">
            <button type="button" class="close_btn" id="closemodal">
              <i class="fa-solid fa-x"></i>
            </button>
            <div class="modal_info">
              <div class="user_img">
                <img src="./image/user.jpg" alt="user image" />
              </div>
              <div class="user_info">
                <label for="user_name">이름</label>
                <input type="text" name="user_name" id="user_name" value="${user_name}"readonly/>
                <label for="user_mbti">MBTI</label>
                <input type="text" name="user_mbti" id="user_mbti" value="${user_mbti}" readonly/>
                <div class="user_url">
                  <a href="#" class="velog_color">
                    <i class="fa-solid fa-v"></i>
                  </a>
                  <a href="#" class="github_color">
                    <i class="fa-brands fa-github"></i>
                  </a>
                </div>
              </div>
            </div>
            <div class="modal_content">
              <label for="advantages">장점</label>
              <textarea name="advantages" id="advantages" readonly>${advantages}</textarea>
              <label for="collaborate">협업 스타일</label>
              <textarea name="collaborate" id="collaborate" readonly>${collaborate}</textarea>
            </div>
            <div class="modal_btns">
              <button type="button" id="fix">수정하기</button>
              <button type="button" id="del">삭제하기</button>
            </div>
          </div>
`;

        $("#card").append(temp_html);
        $("#retouchBg").append(temp_html2);
      });

      $("#postingBtn").click(async function () {
        let doc = { name: "sieun", age: "22" };
        await addDoc(collection(db, "albums"), doc);
      });

      function readURL(input) {
        if (input.files && input.files[0]) {
          let reader = new FileReader();
          let image = document.getElementById("preview");
          image.style.width = "180px";
          image.style.height = "200px";

          reader.onload = function (e) {
            document.getElementById("preview").src = e.target.result;
          };
          reader.readAsDataURL(input.files[0]);
        } else {
          document.getElementById("preview").src = "";
        }
      }
      // 등록하기 이미지첨부

      const regimodal = document.getElementById("regmodal");
      const btnModal = document.getElementById("btn-modal");
      btnModal.addEventListener("click", (e) => {
        regmodal.style.display = "flex";
        retouchBg.style.display = "none";
      });
      const closeBtn = document.getElementById("closemodal");
      closeBtn.addEventListener("click", (e) => {
        regmodal.style.display = "none";
      });
      window.addEventListener("keyup", (e) => {
        if (regmodal.style.display === "flex" && e.key === "Escape") {
          regmodal.style.display = "none";
        }
      });
      // 등록하기 등록버튼 클릭 모달창 on, off

      window.addEventListener("keyup", (e) => {
        if (retouchBg.style.display === "flex" && e.key === "Escape") {
          retouchBg.style.display = "none";
        }
      });

      $(".readmore").click(function () {
        retouchBg.style.display = "flex";
        regmodal.style.display = "none";
      });
      // 삭제 기능 구현

      $("#del").click(function () {
        const docRef = doc(db, "user", "o4iQlieaIhflNGUUPK92");
        deleteDoc(docRef);
        alert("삭제되었습니다.");
      });
    </script>
    <script src="./js/modal.js"></script>
    <script src="./js/look.js"></script>
  </body>
</html>
<!-- 수정하기나 등록하기 누르면 새로고침 되는 자바스크립트 만들기. 
자세히보기 id값은 하나 밖에안되는데 묶어서 할려면 어떻게 해야하는지
새로고침을 할지 안할지 
왜 css가 출력이 안되는지
사진크기맞추기

-->
