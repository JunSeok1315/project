<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>form</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="./임시-김언효.css">
    <link rel="stylesheet" href="CSS/modal_font.css">



    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

</head>




<body>
    <div class="modal_wrap">
        <div class="modal_bg" id="home">
            <div class="wrap">
                <div class="logo">
                    <h1>I Five</h1>
                    <button id="btn-modal">등록⭐</button>

                    <div class="card-wrap " id="card">
                    </div>
                </div>

            </div>
            <div id="regmodal">
                <div class="form_container">
                    <div class="top_bar">
                        <h1 style="margin: auto;">등록하기</h1>

                    </div>
                    <div class="uploadImg">
                        <div class="filebox">
                            <div class="imageupload">
                                <div class="imgbackground">
                                    <img id="preview">
                                </div>
                                <input type="file" id="file1" class="upload-hidden" name="file1" accept="image/*"
                                    onchange="readURL(this);">
                                <label for="file1">이미지 첨부</label>
                            </div>
                            <div class="allfloatinglabel">
                                <div class="floatinglabel1">
                                    <input type="email" class="form-control" id="title" placeholder="이름">
                                </div>
                                <div class="floatinglabel1">
                                    <input type="email" class="form-control" id="MBTI" placeholder="MBTI">
                                </div>
                                <div class="floatinglabel1">
                                    <input type="email" class="form-control" id="BLOG" placeholder="블로그 주소" >
                                </div>
                                <div class="floatinglabel1">
                                    <input type="email" class="form-control" id="GITHUB" placeholder="git hub 주소">
                                </div>
                            </div>
                        </div>
                        <div class="modal_content">
                            <textarea name="advantages" id="advantages" placeholder="장점"></textarea>
                            <textarea name="collaborate" id="collaborate" placeholder="협업 스타일"></textarea>
                        </div>

                        <div class="mybtn">
                            <button type="button" id="savebtn">등록하기</button>
                            <button type="button" id="closemodal">취소하기</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="asdf">
                <div id="retouchBg">
                    

                    </div>
                </div>
            </div>
        </div>
    </div>






    </div>

    </div>

    <script>
        function readURL(input) {
            if (input.files && input.files[0]) {
                let reader = new FileReader();
                let image = document.getElementById('preview');
                image.style.width = '180px';
                image.style.height = '200px';

                reader.onload = function (e) {
                    document.getElementById('preview').src = e.target.result;
                };
                reader.readAsDataURL(input.files[0])
            } else {
                document.getElementById('preview').src = "";
            }
        }
        // 등록하기 이미지첨부 
    </script>
    <script type="module">

        // Firebase SDK 라이브러리 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


        // Firebase 구성 정보 설정
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyBlWLcQ6_x3KoDVDPxGUKmTwsC5SVlqr3s",
            authDomain: "sparta-1b4ed.firebaseapp.com",
            projectId: "sparta-1b4ed",
            storageBucket: "sparta-1b4ed.appspot.com",
            messagingSenderId: "755910145964",
            appId: "1:755910145964:web:20aaf76885c5f8066c2c09",
            measurementId: "G-QSDZY1X816"
        };

        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);









        const regimodal = document.getElementById("regmodal")
        const btnModal = document.getElementById("btn-modal")
        btnModal.addEventListener("click", e => {
            regmodal.style.display = "flex"
            
        })
        const closeBtn = document.getElementById("closemodal")
        closeBtn.addEventListener("click", e => {
            regmodal.style.display = "none"
        })



        window.addEventListener("keyup", e => {
            if (regmodal.style.display === "flex" && e.key === "Escape") {
                regmodal.style.display = "none"
            }
        })
        // 등록하기 등록버튼 클릭 모달창 on, off



     //모달 on, off


 // 수정한부분1 confirm 추가 
        // 자세히 보기 수정하기, 삭제하기

        $("#savebtn").click(async function () {

            let file = $('#file1').val();
            let title = $('#title').val();
            let MBTI = $('#MBTI').val();
            let BLOG = $('#BLOG').val();
            let GITHUB = $('#GITHUB').val();
            let advantages = $('#advantages').val();
            let collaborate = $('#collaborate').val();


            let doc = {
                'file': file,
                'title': title,
                'MBTI': MBTI,
                'BLOG': BLOG,
                'GITHUB': GITHUB,
                'advantages': advantages,
                'collaborate': collaborate,
            };
            await addDoc(collection(db, "idle"), doc);

            alert('저장완료!');
            window.location.reload()


            $(".readmore").click(function () {
                retouchBg.style.display = "flex"
                regmodal.style.display = "none"
                console.log('연결완료') //수정한부분1 새로 생성된 카드에 이벤트 값을 새로 지정 했어야함
            })

        })

        let docs = await getDocs(collection(db, "idle"));
        docs.forEach((doc) => {
            let row = doc.data();


            let title = row['title'];
            let MBTI = row['MBTI'];
            let BLOG = row['BLOG'];
            let GITHUB = row['GITHUB'];
            let advantages = row['advantages'];
            let collaborate = row['collaborate'];

            let temp_html =
                `<div class="card-flip" data-card-id="${doc.id}"> 
                <div class="card-inner" >
                    <div class="front-card">
                        <img src="https://img.freepik.com/free-vector/flat-design-thug-life-sunglasses-illustration_23-2150209328.jpg?w=826&t=st=1703205239~exp=1703205839~hmac=4ca364056d836fb07395ecb75d9f866abbd7e9e7e6513c7bcc112644a803f038"
                            alt="card-img">
                    </div>
                    <div class="back-card">
                        <img src="https://img.freepik.com/free-vector/flat-design-thug-life-sunglasses-illustration_23-2150209328.jpg?w=826&t=st=1703205239~exp=1703205839~hmac=4ca364056d836fb07395ecb75d9f866abbd7e9e7e6513c7bcc112644a803f038"
                            alt="card-img">
                        <h4 class="title">${title}</h4>
                        <a data-toggle="modal" href="#" class="readmore" data-id="${doc.id}">자세히 보기</a>
                    </div>
                </div>
            </div>`



            let temp_detail = `  
                    
                    <div class = "detailmodal" id ="${doc.id}">
                    <div class="modal_container">
                        <button type="button" class="close_btn" id="closemodal">
                            <i class="fa-solid fa-x"></i>
                        </button>
                        <div class="modal_info">
                            <div class="user_img">
                                <img src="./image/user.jpg" alt="user image">
                            </div>
                            <div class="user_info">
                                <label for="user_name">이름</label>
                                <input type="text" name="user_name" id="user_name" value="${title}">
                                <label for="user_mbti">MBTI</label>
                                <input type="text" name="user_mbti" id="user_mbti" value="${MBTI}">
                                <div class="user_url">
                                    <a href="${BLOG}" target='_blank' class="velog_color">
                                        <i class="fa-solid fa-v"></i>
                                    </a>
                                    <a href="${GITHUB}" target='_blank' class="github_color">
                                        <i class="fa-brands fa-github"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="modal_content">
                            <label for="advantages">장점</label>
                            <textarea name="advantages" id="advantages">${advantages}</textarea>
                            <label for="collaborate">협업 스타일</label>
                            <textarea name="collaborate" id="collaborate">${collaborate}</textarea>
                        </div>
                        <div class="modal_btns">
                            <button type="button" class="fixbtn">수정하기</button>
                            <button type="button" class="delbtn">삭제하기</button>
                        </div>
                        </div>
                        
                    </div>
                    `



            $('#card').append(temp_html);
            $("#retouchBg").append(temp_detail);

            $(".readmore").click(async function () {
                let cardId = $(this).attr('data-id')
                $(`#${cardId}`).css('display', 'flex');
              });


        })

        $(".delbtn").click(async function () {

            let detailCardId = $(this).closest('.detailmodal').attr('id')
            
            if(window.confirm("정말 삭제하시겠습니까?")){
                
                console.log(detailCardId)
               

                let delbox = db.collection("idle");
            
                delbox.doc(detailCardId).delete();
                
            }else{
                console.log("취소")
            }
            
          })
        $(".fixbtn").click(function () {
            alert("수정되었습니다.")
            location.reload()
        })



        // 등록하기 버튼 뒤에 파이어베이스 연결하면 새로고침 추가해야댐





     

        // 자세히보기 누를때 카드 id를 가져오는거?


















    </script>




    <!-- 수정하기나 등록하기 누르면 새로고침 되는 자바스크립트 만들기. 
자세히보기 id값은 하나 밖에안되는데 묶어서 할려면 어떻게 해야하는지
새로고침을 할지 안할지 
왜 css가 출력이 안되는지
사진크기맞추기

-->


</body>

</html>